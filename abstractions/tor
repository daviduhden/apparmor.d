# Tor common abstraction
# Purpose: shared permissions for the tor daemon and its transport
# helpers. Keep this abstraction minimal and read-only where possible.
# This file is included by service profiles (e.g., `tor`) and by helper
# transports. Avoid placing writable paths here; leave per-service writable
# directories to the main profile.
#
# See the LICENSE file at the top of the project tree for copyright
# and license details.

  # Standard includes 
  include <abstractions/base>
  include <abstractions/nameservice>

  # Network transports
  # Allow IPv4/IPv6 stream and UDP transports used by Tor and transports.
  network inet stream,
  network inet6 stream,
  network inet udp,
  network inet6 udp,

  # Capabilities 
  # Minimal capabilities that helper processes or the daemon may require.
  capability chown,
  capability dac_read_search,
  capability fowner,
  capability fsetid,
  capability setgid,
  capability setuid,

  # Randomness and devices 
  /dev/null rw,
  /dev/random r,
  /dev/urandom r,

  # Tor binaries and shared data 
  /{usr/,}bin/tor r,
  /{usr/,}sbin/tor r,
  /{usr/,}share/tor/** r,

  # System tunables and hardware info
  /proc/sys/net/core/somaxconn r,
  /proc/sys/kernel/random/uuid r,
  /sys/devices/system/cpu/ r,
  /sys/devices/system/cpu/** r,

  # Configuration
  /etc/tor/** r,

  # Pluggable transports (binaries)
  # Allow execution of bundled pluggable transport helpers where present.
  /{usr/,}bin/obfsproxy PUx,
  /{usr/,}bin/obfs4proxy Pix,
  /{usr/,}bin/snowflake-client Pix,
  /{usr/,}bin/snowflake-server Pix,

